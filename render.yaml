services:
  # Service 1: Gemini Coaching API
  # This service handles the AI nutrition advice
  - type: web
    name: nutrivision-gemini-api
    env: python
    buildCommand: pip install -r backend/requirements_gemini.txt
    startCommand: gunicorn -w 4 -b 0.0.0.0:$PORT backend.gemini_server:app
    envVars:
      - key: GEMINI_API_KEY
        sync: false

  # Service 2: Food Recognition Model API
  # This service handles image prediction using TensorFlow
  - type: web
    name: nutrivision-model-api
    env: python
    buildCommand: pip install -r backend/requirements_model.txt
    startCommand: gunicorn -w 1 -b 0.0.0.0:$PORT backend.model_server:app

  # Service 3: Frontend Web App
  # This serves the Expo web export as a static site
  - type: static
    name: nutrivision-web
    env: static
    buildCommand: npm install -g pnpm && pnpm install && npx expo export
    staticPublishPath: dist
    envVars:
      - key: EXPO_PUBLIC_MODEL_API_URL
        fromService:
          type: web
          name: nutrivision-model-api
          property: url
      - key: EXPO_PUBLIC_GEMINI_API_URL
        fromService:
          type: web
          name: nutrivision-gemini-api
          property: url

